var $game,__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),Game=function(e){function t(){var t=e.call(this)||this;return t._score=0,t._coin=0,t._distance=0,t.floorRight=0,t.last_mapData=null,t.levelChangeDistance=1e3,t._state="",$game=t,t.camLayer=new Sprite,t.addChild(t.camLayer),t.uiLayer=new Sprite,t.addChild(t.uiLayer),t.bg=new BG,t.camLayer.addChild(t.bg),t.itemPlace=new Sprite,t.camLayer.addChild(t.itemPlace),t.itemManager=new ItemManager,t.itemManager.start(t),t.player=new Player,t.camLayer.addChild(t.player),t.player.pos(350,400),t.player.on("die",t,t.onDie),t.cam=new Cam,t.cam.start(t.camLayer,t.player,t),t.tileParser=new TileParser,t.tileParser.start(t.itemPlace),t.createFloor(0),Laya.timer.frameLoop(1,t,t.update),t.beginUI=new ui.BeginUIUI,t.addChild(t.beginUI),t.beginUI.startButton.on(Laya.Event.CLICK,t,t.onBeginGame),t.beginUI.rankButton.on(Laya.Event.CLICK,t,t.onOpenRank),t.gameUI=new ui.GameUI,t.addChild(t.gameUI),t.gameUI.visible=!1,t.gameOverUI=new ui.GameOverUI,t.addChild(t.gameOverUI),t.gameOverUI.visible=!1,t.gameOverUI.restartButton.on(Laya.Event.CLICK,t,t.onRestart),t.player.start(t),t}return __extends(t,e),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e,null!=this.gameUI&&(this.gameUI.scoreLabel.text=String(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coin",{get:function(){return this._coin},set:function(e){this._coin=e,this.updateScore()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},set:function(e){this._distance=e},enumerable:!0,configurable:!0}),t.prototype.updateScore=function(){this.score=10*this.coin},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),t.prototype.start=function(){},t.prototype.update=function(){this.player.update(),this.cam.update(),this.bg.update(this.cam.camX),this.itemManager.update(this.cam.camX);if(this.cam.camX+Cof.DesinWidth>this.floorRight-100){var e=Math.floor(this.distance/this.levelChangeDistance)+1,t=this.chooseLv(e);this.createFloor(t)}},t.prototype.createFloor=function(e){console.log("createFloor:",e),e>$data.mapLab.length-1&&(e=$data.mapLab.length-1);var t=$data.mapLab[e],a=Math.floor(Math.random()*t.length),n=t[a];this.last_mapData==n&&(n=t[a=Math.floor(Math.random()*t.length)]),this.last_mapData=n;var r=Laya.loader.getRes(n);this.floorRight=this.tileParser.parse(r,this.floorRight)},t.prototype.chooseLv=function(e){var t=Math.random();return 1==e?t<.7?1:2:2==e?t<.4?1:t<.8?2:3:3==e?t<.2?1:t<.6?2:3:4==e?t<.1?1:t<.5?2:3:5==e?t<.4?2:3:6==e?t<.3?2:t<.8?3:4:7==e?t<.2?2:t<.6?3:4:8==e?t<.4?3:4:9==e?t<.3?3:4:10==e&&t<.2?3:4},t.prototype.onBeginGame=function(){this.beginUI.visible=!1,this.player.isRun=!0,$musicManager.begin(),this.gameUI.visible=!0},t.prototype.onDie=function(){$musicManager.end(),this.gameUI.visible=!1,this.gameOverUI.visible=!0,this.gameOverUI.ani1.play(0,!1),this.gameOverUI.scoreLabel.text=String(this.score),$openView.setScore(this.score)},t.prototype.onRestart=function(){for(var e=this.itemManager.itemList,t=0;t<e.length;t++){var a=e[t];this.itemManager.remove(a),this.event("restart")}},t.prototype.onOpenRank=function(){$openView.openRank()},t}(Sprite);