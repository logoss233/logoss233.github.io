var __extends=this&&this.__extends||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),Player=function(t){function i(){var i=t.call(this)||this;return i.currentAnimation="",i.gravity=.388,i.hspeed=0,i.vspeed=0,i.runSpeed=8.33,i.jumpSpeed=10,i.isRun=!1,i.isFloor=!1,i.lastPressedAction="",i.lastPressedTimer=0,i.lastPressedTime=.15,i.slide_timer=0,i.slide_time=.7,i._isMagnent=!1,i.magnent_timer=0,i.magnent_time=8,i._isShield=!1,i.shield_timer=0,i.shield_time=8,i._state="",i.ani=new Animation,i.addChild(i.ani),i.ani.loadAnimation("PlayerAnimation.ani"),i.ani.pos(-64,-64),i.playAni("idle"),i.shieldAni=new Animation,i.addChild(i.shieldAni),i.shieldAni.loadAnimation("ShieldAnimation.ani"),i.shieldAni.scale(2,2),i.shieldAni.pos(-64,-64),i.shieldAni.play(0,!0,"ani1"),i.shieldAni.visible=!1,i.magnentAni=new Animation,i.addChild(i.magnentAni),i.magnentAni.loadAnimation("MagnentAnimation.ani"),i.magnentAni.alpha=.7,i.magnentAni.pos(-32,-106),i.magnentAni.play(0,!0,"ani1"),i.magnentAni.visible=!1,i}return __extends(i,t),i.prototype.setLastPressed=function(t){this.lastPressedAction=t,this.lastPressedTimer=this.lastPressedTime},Object.defineProperty(i.prototype,"isMagnent",{get:function(){return this._isMagnent},set:function(t){this._isMagnent=t,this._isMagnent?(this.magnent_timer=this.magnent_time,this.magnentAni.visible=!0):this.magnentAni.visible=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isShield",{get:function(){return this._isShield},set:function(t){this._isShield=t,this._isShield?(this.shield_timer=this.shield_time,this.shieldAni.visible=!0):this.shieldAni.visible=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(t){switch(this.state){case"normal":break;case"slide":this.ani.y=-64}switch(this._state=t,this.state){case"normal":this.setBounds(new Rectangle(-28,-58,56,116));break;case"slide":this.setBounds(new Rectangle(-28,4,56,56)),this.slide_timer=this.slide_time,this.playAni("slide"),this.ani.y=-51;break;case"die":this.isMagnent&&(this.isMagnent=!1),this.vspeed=-8,this.playAni("jumpDown"),this.isRun=!1,this.rotation=-45,this.event("die")}},enumerable:!0,configurable:!0}),i.prototype.start=function(t){this.game=t,this.itemManager=t.itemManager,this.state="normal",$game.gameUI.downButton.on(Laya.Event.MOUSE_DOWN,this,this.onRightMouseDown),$game.gameUI.upButton.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on(Laya.Event.KEY_DOWN,this,this.onKeyDown)},i.prototype.update=function(){switch(this.hspeed=0,this.vspeed+=this.gravity,this.state){case"normal":this.isFloor&&"jump"==this.lastPressedAction&&(this.vspeed=-this.jumpSpeed,this.lastPressedAction=""),this.isFloor&&"down"==this.lastPressedAction&&(this.state="slide",this.lastPressedAction="");break;case"slide":this.slide_timer-=1/60,this.slide_timer<=0&&(this.state="normal"),this.isFloor&&"jump"==this.lastPressedAction&&(this.vspeed=-this.jumpSpeed,this.state="normal");break;case"die":this.hspeed=-3}this.isRun&&(this.hspeed=this.runSpeed),this.x+=this.hspeed,this.vspeed>10&&(this.vspeed=10),"die"!=this.state&&this.collision(),this.y+=this.vspeed;var t="";"normal"==this.state&&(t=this.isFloor?0!=this.hspeed?"run":"idle":this.vspeed<0?"jumpUp":"jumpDown"),""!=t&&t!=this.currentAnimation&&this.playAni(t),"die"!=this.state&&this.y>850&&(this.state="die"),this.isMagnent&&(this.magnent_timer-=1/60,this.magnent_timer<=0&&(this.isMagnent=!1)),this.isShield&&(this.shield_timer-=1/60,this.shield_timer<=0&&(this.isShield=!1)),""!=this.lastPressedAction&&(this.lastPressedTimer-=1/60,this.lastPressedTimer<=0&&(this.lastPressedAction=""))},i.prototype.collision=function(){if(this.isFloor=!1,this.vspeed>=0){var t=new Rectangle;t.x=this.x-32,t.width=64,t.y=this.y+this.vspeed+64-2-4,t.height=2;for(e=0;e<this.itemManager.floorList.length;e++){var i=this.itemManager.floorList[e];if(i.getBounds().intersection(t)){this.isFloor=!0,this.vspeed=0,this.y=i.getBounds().y-64+4;break}}}t=this.getBounds();for(e=0;e<this.itemManager.eatItemList.length;e++){(s=this.itemManager.eatItemList[e]).getBounds().intersection(t)&&s.eat()}if(!this.isShield)for(var e=0;e<this.itemManager.enemyList.length;e++){var s=this.itemManager.enemyList[e];s.getBounds().intersection(t)&&(this.state="die")}},i.prototype.playAni=function(t){this.currentAnimation=t,this.ani.play(0,!0,t)},i.prototype.onMouseDown=function(){this.isRun&&this.setLastPressed("jump")},i.prototype.onRightMouseDown=function(){this.isRun&&this.setLastPressed("down")},i.prototype.onKeyDown=function(t){38==t.keyCode&&this.setLastPressed("jump"),40==t.keyCode&&this.setLastPressed("down")},i}(Sprite);